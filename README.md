# 📝 미션 설계 - Java 와 Sping으로 난제 해결하기

## 미션 주제

<aside>
💡

**한정 재고 품목의 동시성 및 트래픽 관리**

</aside>

단순한 문제 풀이를 넘어, 문제 발생의 본질을 파악하고 현실에서 발생할 수 있는 **트래픽 쏠림 현상 시, 발생하는 문제를** 예상해보고 해결하는 것에 초점을 맞춥니다.

## 설계 로드맵

**개인적 소회**

- 3주간 미션을 해결해보면서 자바에 생소했던 초기에 비해 실력이 많이 성장하였습니다.
- 프리코스 이전에는 단순히 자바를 다루는 실력을 늘리고 싶다, 개발 능력을 향상시키고 싶다는 추상적인 목표였습니다.
- 3주가 지난 지금, 익숙해진 자바를 이용해서 현실에서 발생하는 어렵고 구체적인 문제 상황을 해결하는 경험이 있으면 좋을 것이라고 생각하였습니다.

**설계 의도** : 실제 실무에서 많이 발생하며 중요하게 다루어지는 소재를 해결할 수 있는 시나리오

- 동시성  제어
- 요청 순서 제어
- 트래픽 처리

**설계 방향 :** 최소 사양 프로그램 구현 → 리스크 설정 및 문제 발생 시나리오 제공 →  redis, 분산락, 큐잉 등의 기술 적용을 통한 해결

1. 기본적인 요구사항에 맞추어 재고 시스템을 구현
    - 주문, 재고 조회, 차감 등의 요구사항을 만족시키는 형태
    - Spring Boot와 RDB(MySQL)를 이용한 기본적인 기능을 구현
2. 기본적인 기능 구현에서 의도적으로 문제 상황을 발생
    - 여러 사용자의 동시 요청을 통해 쿠폰 발급을 시도
    - **동시성 이슈, 트래픽 과부화 이슈 등의 시나리오 상정**
3. 문제를 해결하기 위해 기술 도입 및 기술 적용 전/ 후 성능 및 안정성 비교
    - DB lock, 분산 락, Redis, Kafka 등 문제 해결을 위한 개념을 학습 및 적용
    - 적용 후 **결과의 비교를 통한 실제 효과 확인**
4. 문제 해결 과정에서 얻은 인사이트, 시행착오, 의사결정, 성능 비교 결과 확인
    - 문제를 해결하는 방식에 정답은 없음 (많은 방법들이 존재)
    - **기술 선택의 이유와 비교를 통해 개발 논리의 기반을 다짐**
    - **해결 과정에서 발생하는 여러 문제들과 고민을 통해 성장**

# 📌 미션 - 선착순 쿠폰 발급 프로그램 만들기

<aside>
🛠️

선착순으로 접속한 10명의 사용자에게 커피 무료 쿠폰을 발급하는 프로그램을 구현

</aside>

### 문제 요구사항

선착순 쿠폰 발급 프로그램의 조건은 다음과 같다.

1. 쿠폰의 수량은 한정적이다. (10개)
2. 쿠폰은 선착순으로 10명까지만 발급 받을 수 있다.
3. 쿠폰은 중복해서 발급 받을 수 없다.
4. 단시간에 급증하는 트래픽을 버텨야한다.  (1000개 이상)

### 학습 요구사항

1. 단순한 형태에서 개선해 나가는 방식으로 프로그램을 구현한다.
2. 동시성 문제, 트래픽 처리에 관한 개념을 학습한다.
3. 문제를 해결하기 위한 기술을 비교하고 성능을 테스트한다.
4. 적합한 기술을 적용하여 프로그램을 개선한다.

### 프로그래밍 요구사항

1. 자바 언어와 필요 시 Spring Boot를 사용한다.
2. 우아한 테크코스의 코딩 컨벤션을 따른다.

---

해결 과정 보고서
https://gb6105.notion.site/2b4d3a51446180249d4ae94a3669c2f0?source=copy_link

# 💡 결론

**문제 해결 결과를 바탕으로 세운 나만의 해결 기준**

앞으로 개발을 하면서 “동시성” + “요청 순서 처리” + “트래픽 처리”라는 문제를 만난다면 다음과 같이 기준을 통해서 해결을 할 수 있을 것 같습니다.

- **동시성 문제는 분산락으로 해결 (Redisson / Lettuce)**

  → 확장성 및 안정성을 고려하여 DB Lock 보다는 분산 락을 적용하는 것이 좋다.

  → 요청에 대해서 재시도가 필요하다면 Redisson, 재시도가 필요없다면 Lettuce를 도입할 수 있다.

- **요청 순서는 클라이언트가 아닌 서버 도착 기반으로 처리! (Queue를 사용)**

  → Redisson도 구조 상 특징에 의해 어느 정도 순서를 보장해준다.

  → Queue 자료구조를 이용하여 처리를 순서대로 받고 하나씩 처리함으로써 더 엄밀하게 순서를 보장시킬 수 있다.

- **급증하는 트래픽은 메시지 큐잉으로 흐름 제어**

  설계 고려가 먼저, 기술의 도입은 설계에 맞추면 된다.

    1. RDBMS와 통신 횟수를 쿼리를 통해서 줄일 수 있다면 우선적으로 고려한다.
    2. Redis와 같은 인메모리 DB를 도입하여서 RDBMS에 부하를 줄여줄 수 있다.
    3. Queue를 이용해 처리 요청을 저장 및 처리 하여 서버의 처리량에 맞게 흐름을 제어할 수 있다.

---